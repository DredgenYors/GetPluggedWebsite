{% extends "base.html" %}

{% block title %}Previous Events - GetPlugged{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- Large Title Banner -->
        <div class="events-banner bg-success text-white p-5 rounded-3 mb-4 text-center">
            <h1 class="display-3 fw-bold mb-0">Previous Events</h1>
        </div>

        <!-- Main Content Split Layout -->
        <div class="row g-4">
            <form method="GET" class="d-flex justify-content-center mb-4">
                <div style="max-width: 520px;" class="w-100">
                    <select name="event" class="form-select" onchange="this.form.submit()">
                    <option value="all" {% if selected_event_key == 'all' %}selected{% endif %}>
                        All Events
                    </option>
                    {% for e in events %}
                        <option value="{{ e.id }}" {% if selected_event and e.id == selected_event.id %}selected{% endif %}>
                        {{ e.title }} — {{ e.date.strftime('%Y-%m-%d') }}
                        </option>
                    {% endfor %}
                    </select>

                    {% if selected_event %}
                    <div class="text-center text-muted mt-2">
                        Viewing: <strong>{{ selected_event.title }}</strong>
                        {% if selected_event.location %} • {{ selected_event.location }}{% endif %}
                    </div>
                    {% endif %}
                </div>
                </form>
            <!-- Left Side - Artist Profiles List -->
            <div class="col-lg-6">
                <div class="artists-list-section">
                    <h3 class="text-success mb-3">
                        <i class="fas fa-music me-2"></i>Featured Artists
                    </h3>
                    <div class="artists-list bg-dark p-4 rounded-3 gp-bordered">
                        {% if all_artists %}
                            {% for artist in all_artists %}
                                <div class="artist-card mb-3 p-3 rounded">
                                    <div class="d-flex justify-content-center align-items-center">
                                        <div class="artist-info text-center w-100">
                                            <!-- Artist Name -->
                                            <div class="text-light fs-5 fw-semibold">
                                                {{ artist.display_name }}
                                            </div>

                                            <!-- Instagram Handle (optional) -->
                                            {% if artist.instagram_handle %}
                                                <a href="https://instagram.com/{{ artist.instagram_handle }}"
                                                target="_blank"
                                                class="text-success text-decoration-none">
                                                    @{{ artist.instagram_handle }}
                                                </a>
                                            {% else %}
                                                <div class="text-muted small">No Instagram provided</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-music fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">No Artist Profiles Found</h5>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Right Side - Media Section -->
            <div class="col-lg-6">
                <div class="media-section">
                    <h3 class="text-success mb-3">
                        <i class="fas fa-film me-2"></i>Media
                    </h3>

                    <!-- Video Section -->
                    <div class="video-section mb-4">
                        <div class="media-container bg-dark p-3 rounded-3 gp-bordered">
                            <h5 class="text-light mb-3">
                                <i class="fas fa-video me-2"></i>Videos
                            </h5>
                            <div class="video-player-container position-relative">
                                <div class="video-placeholder bg-secondary rounded d-flex align-items-center justify-content-center gp-media-placeholder">
                                    {% if videos %}
                                        <div class="text-muted mb-2">{{ videos|length }} videos</div>
                                        <ul class="list-unstyled mb-0">
                                            {% for v in videos %}
                                                <li class="mb-2">
                                                    <a href="{{ v.url }}" target="_blank" class="text-info text-decoration-none">
                                                        {{ v.caption if v.caption else "Video " ~ loop.index }}
                                                    </a>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    {% else %}
                                        <p class="text-muted mb-0">No videos yet.</p>
                                    {% endif %}
                                </div>
                                <div class="video-controls mt-3 d-flex justify-content-center">
                                    <button class="btn btn-outline-light me-3" id="prevVideo" onclick="previousVideo()">
                                        <i class="fas fa-chevron-left"></i> Previous
                                    </button>
                                    <span class="align-self-center text-muted mx-3" id="videoCounter">0 / 0</span>
                                    <button class="btn btn-outline-light ms-3" id="nextVideo" onclick="nextVideo()">
                                        Next <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Image Section -->
                    <div class="image-section">
                        <div class="media-container bg-dark p-3 rounded-3 gp-bordered">
                            <h5 class="text-light mb-3">
                                <i class="fas fa-images me-2"></i>Photos
                            </h5>
                            <div class="image-gallery-container position-relative">
                                <div class="image-placeholder bg-secondary rounded d-flex align-items-center justify-content-center gp-media-placeholder">
                                    {% if photos %}
                                        <div class="text-muted mb-2">{{ photos|length }} photos</div>
                                        <ul class="list-unstyled mb-0">
                                            {% for p in photos %}
                                                <li class="mb-2">
                                                    <a href="{{ p.url }}" target="_blank" class="text-info text-decoration-none">
                                                        {{ p.caption if p.caption else "Photo " ~ loop.index }}
                                                    </a>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    {% else %}
                                        <p class="text-muted mb-0">No photos yet.</p>
                                    {% endif %}
                                </div>
                                <div class="image-controls mt-3 d-flex justify-content-center">
                                    <button class="btn btn-outline-light me-3" id="prevImage" onclick="previousImage()">
                                        <i class="fas fa-chevron-left"></i> Previous
                                    </button>
                                    <span class="align-self-center text-muted mx-3" id="imageCounter">0 / 0</span>
                                    <button class="btn btn-outline-light ms-3" id="nextImage" onclick="nextImage()">
                                        Next <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
{% block scripts %}
<script>
    let currentVideoIndex = 0;
    let currentImageIndex = 0;
    let currentEventVideos = [];
    let currentEventImages = [];

    function updateVideoDisplay() {
        const videoCounter = document.getElementById('videoCounter');
        const videoMediaContent = document.getElementById('videoMediaContent');

        if (currentEventVideos.length > 0) {
            videoCounter.textContent = `${currentVideoIndex + 1} / ${currentEventVideos.length}`;
            videoMediaContent.innerHTML = `
            <div class="text-center">
                <i class="fas fa-play-circle fa-4x text-light mb-2"></i>
                <p class="text-light mb-1">Video ${currentVideoIndex + 1}</p>
                <small class="text-muted">${currentEventVideos[currentVideoIndex]}</small>
            </div>
        `;
        } else {
            videoCounter.textContent = '0 / 0';
            videoMediaContent.innerHTML = `
            <div class="text-center">
                <p class="text-muted mb-0">No videos available</p>
                <small class="text-muted">Videos Coming Soon</small>
            </div>
        `;
        }
    }

    function updateImageDisplay() {
        const imageCounter = document.getElementById('imageCounter');
        const imageMediaContent = document.getElementById('imageMediaContent');

        if (currentEventImages.length > 0) {
            imageCounter.textContent = `${currentImageIndex + 1} / ${currentEventImages.length}`;
            imageMediaContent.innerHTML = `
            <div class="text-center">
                <i class="fas fa-camera fa-4x text-light mb-2"></i>
                <p class="text-light mb-1">Photo ${currentImageIndex + 1}</p>
                <small class="text-muted">${currentEventImages[currentImageIndex]}</small>
            </div>
        `;
        } else {
            imageCounter.textContent = '0 / 0';
            imageMediaContent.innerHTML = `
            <div class="text-center">
                <p class="text-muted mb-0">No photos available</p>
                <small class="text-muted">Photos Coming Soon</small>
            </div>
        `;
        }
    }

    function previousVideo() {
        if (currentEventVideos.length > 0) {
            currentVideoIndex = (currentVideoIndex - 1 + currentEventVideos.length) % currentEventVideos.length;
            updateVideoDisplay();
        }
    }

    function nextVideo() {
        if (currentEventVideos.length > 0) {
            currentVideoIndex = (currentVideoIndex + 1) % currentEventVideos.length;
            updateVideoDisplay();
        }
    }

    function previousImage() {
        if (currentEventImages.length > 0) {
            currentImageIndex = (currentImageIndex - 1 + currentEventImages.length) % currentEventImages.length;
            updateImageDisplay();
        }
    }

    function nextImage() {
        if (currentEventImages.length > 0) {
            currentImageIndex = (currentImageIndex + 1) % currentEventImages.length;
            updateImageDisplay();
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        currentEventVideos = [];
        currentEventImages = [];
        currentVideoIndex = 0;
        currentImageIndex = 0;
        updateVideoDisplay();
        updateImageDisplay();
    });

</script>
{% endblock %}
{% extends "base.html" %}

{% block title %}Purchase Tickets - GetPlugged{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card shadow-lg mb-5">
            <div class="card-header bg-primary text-white text-center">
                <h2 class="mb-0">Purchase Tickets</h2>
            </div>
            <div class="card-body">
                <form id="ticketForm">
                    <!-- Event Selection -->
                    <div class="mb-4">
                        <label for="eventSelect" class="form-label fw-bold">Select Event:</label>
                        <select class="form-select" id="eventSelect" required>
                            {% for event in events %}
                                <option value="{{ loop.index0 }}">{{ event.title }} - {{ event.date }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <!-- Event Details -->
                    <div id="eventDetails" class="mb-4">
                        <!-- Populated by JS -->
                    </div>
                    <!-- Ticket Counter -->
                    <div class="mb-4 d-flex align-items-center">
                        <label class="form-label fw-bold me-3 mb-0">Tickets:</label>
                        <button type="button" class="btn btn-outline-secondary btn-sm me-2" id="decreaseBtn">-</button>
                        <span id="ticketCount" class="fs-5 fw-bold">1</span>
                        <button type="button" class="btn btn-outline-secondary btn-sm ms-2" id="increaseBtn">+</button>
                    </div>
                    <!-- Order Total -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">Order Total:</label>
                        <span id="orderTotal" class="fs-5 text-success ms-2">$20.00</span>
                    </div>
                    <!-- Proceed to Payment Button -->
                    <div class="d-grid">
                        <button type="button" class="btn btn-primary btn-lg" id="payBtn">Proceed to Payment</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
const ticketEvents = {{ events|tojson }};
const ticketPrice = 20.00;
let selectedEventIdx = 0;
let ticketCount = 1;

// Populate event details
function updateEventDetails() {
    const detailsDiv = document.getElementById('eventDetails');
    const event = ticketEvents[selectedEventIdx];
    detailsDiv.innerHTML = `
        <div class="p-3 bg-light rounded border">
            <h4 class="mb-2 text-primary">${event.title}</h4>
            <p class="mb-1"><strong>Date:</strong> ${event.date}</p>
            <p class="mb-1"><strong>Location:</strong> ${event.location}</p>
            <p class="mb-0"><strong>Details:</strong> ${event.description || 'No description available.'}</p>
        </div>
    `;
}

// Update order total
function updateOrderTotal() {
    document.getElementById('orderTotal').textContent = `$${(ticketCount * ticketPrice).toFixed(2)}`;
}

// Handle ticket count changes
document.getElementById('increaseBtn').onclick = function() {
    ticketCount++;
    document.getElementById('ticketCount').textContent = ticketCount;
    updateOrderTotal();
};
document.getElementById('decreaseBtn').onclick = function() {
    if (ticketCount > 1) {
        ticketCount--;
        document.getElementById('ticketCount').textContent = ticketCount;
        updateOrderTotal();
    }
};

// Handle event selection change
document.getElementById('eventSelect').onchange = function() {
    selectedEventIdx = parseInt(this.value);
    updateEventDetails();
    ticketCount = 1;
    document.getElementById('ticketCount').textContent = ticketCount;
    updateOrderTotal();
};

// Payment button navigation
document.getElementById('payBtn').onclick = function() {
    window.location.href = "/payment";
};

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    updateEventDetails();
    updateOrderTotal();
});
</script>
{% endblock %}